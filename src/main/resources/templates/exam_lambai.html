<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Thi: <span th:text="${exam.title}">Tiêu đề</span></title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
  <script>
    let durationSeconds = /*[[${exam.durationMinutes}]]*/ * 60;
    let timerInterval;

    function startTimer() {
      const timerEl = document.getElementById('timer');
      timerInterval = setInterval(() => {
        if (durationSeconds <= 0) {
          clearInterval(timerInterval);
          alert('Hết giờ! Bài thi sẽ được tự động nộp.');
          document.getElementById('examForm').submit();
          return;
        }
        let minutes = Math.floor(durationSeconds / 60);
        let seconds = durationSeconds % 60;
        timerEl.textContent = `Thời gian còn lại: ${minutes} phút ${seconds} giây`;
        durationSeconds--;
      }, 1000);
    }

    window.onload = startTimer;
  </script>
</head>
<body>
<div class="container mt-4">
  <h2>📝 Làm bài thi: <span th:text="${exam.title}"></span></h2>
  <p th:text="${exam.description}"></p>

  <div id="timer" class="alert alert-info font-weight-bold"></div>

  <form th:action="@{/exam/submit}" method="post" id="examForm">
    <input type="hidden" name="examId" th:value="${exam.id}" />

    <div th:each="quizItem, iterStat : ${exam.quizItems}">
      <div class="form-group">
        <label th:text="'Câu ' + (${iterStat.index} + 1) + ': ' + quizItem.text"></label>
        <div>
          <div th:each="opt, idx : ${quizItem.options}">
            <input type="radio"
                   th:id="'q' + ${iterStat.index} + '_opt' + ${idx.index}"
                   th:name="'answers[' + ${iterStat.index} + ']'"
                   th:value="${#lists.array('A','B','C','D')[idx.index]}"
                   required />
            <label th:for="'q' + ${iterStat.index} + '_opt' + ${idx.index}"
                   th:text="${#lists.array('A','B','C','D')[idx.index]} + '. ' + opt"></label>
          </div>
        </div>
      </div>
    </div>

    <button type="submit" class="btn btn-success">Nộp bài</button>
  </form>
</div>
</body>
</html>
